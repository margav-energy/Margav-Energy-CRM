{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}
{% block title %}{{ title }} | {{ site_title|default:_('Margav Energy CRM Administration') }}{% endblock %} {% block extrahead %} {{ block.super }}
<style>
  /* Dark mode styles */
  .dark-theme .admin-dashboard {
    background: #1a1a1a;
    color: #ffffff;
  }
  
  .dark-theme .dashboard-header {
    background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
  }
  
  .dark-theme .stat-card {
    background: #2d3748;
    color: #ffffff;
    border-left: 4px solid #667eea;
  }
  
  .dark-theme .stat-card:hover {
    background: #4a5568;
  }
  
  .dark-theme .stat-number {
    color: #ffffff;
  }
  
  .dark-theme .stat-label {
    color: #e2e8f0;
  }
  
  .dark-theme .stat-filter {
    color: #a0aec0;
  }
  
  .dark-theme .action-card {
    background: #2d3748;
    color: #ffffff;
  }
  
  .dark-theme .action-card:hover {
    background: #4a5568;
  }
  
  .dark-theme .action-card h3 {
    color: #ffffff;
  }
  
  .dark-theme .action-card p {
    color: #e2e8f0;
  }
  
  .dark-theme .activity-item {
    background: #2d3748;
    color: #ffffff;
  }
  
  .dark-theme .activity-item:hover {
    background: #4a5568;
  }
  
  .dark-theme .activity-title {
    color: #ffffff;
  }
  
  .dark-theme .activity-time {
    color: #a0aec0;
  }
  .admin-dashboard {
    padding: 20px;
    background: #f8f9fa;
    min-height: 100vh;
  }

  .dashboard-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }

  .dashboard-header h1 {
    margin: 0;
    font-size: 2.5rem;
    font-weight: 300;
  }

  .dashboard-header p {
    margin: 10px 0 0 0;
    opacity: 0.9;
    font-size: 1.1rem;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    border-left: 4px solid #667eea;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
  }

  .stat-card.agents {
    border-left-color: #4caf50;
  }
  .stat-card.qualifiers {
    border-left-color: #ff9800;
  }
  .stat-card.salesreps {
    border-left-color: #2196f3;
  }
  .stat-card.leads {
    border-left-color: #9c27b0;
  }

  .stat-number {
    font-size: 2.5rem;
    font-weight: bold;
    color: #333;
    margin: 0;
  }

  .stat-label {
    color: #666;
    font-size: 1rem;
    margin: 5px 0 0 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stat-filter {
    color: #999;
    font-size: 0.8rem;
    margin: 5px 0 0 0;
    font-style: italic;
  }

  .stat-card {
    cursor: pointer;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
  }

  .quick-actions {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    margin-bottom: 30px;
  }

  .quick-actions h2 {
    margin: 0 0 20px 0;
    color: #333;
    font-size: 1.5rem;
  }

  .action-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
  }

  .action-btn {
    display: inline-flex;
    align-items: center;
    padding: 15px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white !important;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.2s ease;
    border: none;
    cursor: pointer;
  }

  .action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    color: white !important;
    text-decoration: none;
  }

  .action-btn * {
    color: white !important;
  }

  .action-btn.primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white !important;
  }
  .action-btn.success {
    background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
    color: white !important;
  }
  .action-btn.warning {
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    color: white !important;
  }
  .action-btn.danger {
    background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
    color: white !important;
  }

  .recent-activity {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
  }

  .recent-activity h2 {
    margin: 0 0 20px 0;
    color: #333;
    font-size: 1.5rem;
  }

  .activity-item {
    display: flex;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid #eee;
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    font-size: 1.2rem;
  }

  .activity-icon.user {
    background: #e3f2fd;
    color: #1976d2;
  }
  .activity-icon.lead {
    background: #f3e5f5;
    color: #7b1fa2;
  }
  .activity-icon.dialer {
    background: #e8f5e8;
    color: #388e3c;
  }

  .activity-content {
    flex: 1;
  }

  .activity-title {
    font-weight: 500;
    color: #333;
    margin: 0 0 5px 0;
  }

  .activity-time {
    color: #666;
    font-size: 0.9rem;
  }

  @media (max-width: 768px) {
    .stats-grid {
      grid-template-columns: 1fr;
    }

    .action-buttons {
      grid-template-columns: 1fr;
    }

    .dashboard-header h1 {
      font-size: 2rem;
    }
  }
</style>
{% endblock %} {% block content %}
<div class="admin-dashboard">
  <div class="dashboard-header">
    <h1>Admin Dashboard</h1>
    <p>Manage users, leads, and system settings</p>
  </div>

  <div class="stats-grid">
    <div class="stat-card agents" onclick="filterUsers('agent')">
      <p class="stat-number">{{ agents_count }}</p>
      <p class="stat-label">Agents</p>
      <p class="stat-filter">Click to filter</p>
    </div>
    <div class="stat-card qualifiers" onclick="filterUsers('qualifier')">
      <p class="stat-number">{{ qualifiers_count }}</p>
      <p class="stat-label">Qualifiers</p>
      <p class="stat-filter">Click to filter</p>
    </div>
    <div class="stat-card salesreps" onclick="filterUsers('salesrep')">
      <p class="stat-number">{{ salesreps_count }}</p>
      <p class="stat-label">Sales Reps</p>
      <p class="stat-filter">Click to filter</p>
    </div>
    <div class="stat-card leads" onclick="filterLeads()">
      <p class="stat-number">{{ total_leads }}</p>
      <p class="stat-label">Total Leads</p>
      <p class="stat-filter">Click to filter</p>
    </div>
  </div>

  <div class="quick-actions">
    <h2>Quick Actions</h2>
    <div class="action-buttons">
      <a
        href="{% url 'admin:accounts_user_changelist' %}"
        class="action-btn primary"
      >
        üë• Manage Users
      </a>
      <a
        href="{% url 'admin_accounts_user_bulk_creation' %}"
        class="action-btn success"
      >
        ‚ûï Bulk Create Users
      </a>
      <a
        href="{% url 'admin:leads_dialeruserlink_changelist' %}"
        class="action-btn warning"
      >
        üîó Dialer Links
      </a>
      <a href="{% url 'admin:leads_lead_changelist' %}" class="action-btn">
        üìã View Leads
      </a>
      <a href="{% url 'admin:accounts_user_add' %}" class="action-btn success">
        ‚ûï Add New User
      </a>
      <button onclick="showDeleteUserModal()" class="action-btn danger">
        üóëÔ∏è Delete User
      </button>
    </div>
  </div>

</div>

<!-- Delete User Modal -->
<div
  id="deleteUserModal"
  style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
  "
>
  <div
    style="
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      min-width: 400px;
    "
  >
    <h3 style="margin: 0 0 20px 0; color: #333">Delete User</h3>
    <p style="margin: 0 0 20px 0; color: #666">
      Enter the username of the user you want to delete:
    </p>
    <input
      type="text"
      id="deleteUsername"
      placeholder="Enter username"
      style="
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        margin-bottom: 20px;
      "
    />
    <div style="display: flex; gap: 10px; justify-content: flex-end">
      <button
        onclick="hideDeleteUserModal()"
        style="
          padding: 10px 20px;
          border: 1px solid #ddd;
          background: white;
          border-radius: 6px;
          cursor: pointer;
        "
      >
        Cancel
      </button>
      <button
        onclick="deleteUser()"
        style="
          padding: 10px 20px;
          background: #f44336;
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
        "
      >
        Delete User
      </button>
    </div>
  </div>
</div>

<script>
  function showDeleteUserModal() {
    document.getElementById("deleteUserModal").style.display = "block";
  }

  function hideDeleteUserModal() {
    document.getElementById("deleteUserModal").style.display = "none";
    document.getElementById("deleteUsername").value = "";
  }

  function deleteUser() {
    const username = document.getElementById("deleteUsername").value;
    if (!username) {
      alert("Please enter a username");
      return;
    }

    if (
      confirm(
        `Are you sure you want to delete user "${username}"? This action cannot be undone.`
      )
    ) {
      fetch(`/admin/accounts/user/delete/${username}/`, {
        method: "DELETE",
        headers: {
          "X-CSRFToken": "{{ csrf_token }}",
          "Content-Type": "application/json",
        },
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            alert("User deleted successfully");
            hideDeleteUserModal();
            location.reload();
          } else {
            alert("Error: " + data.error);
          }
        })
        .catch((error) => {
          alert("Error: " + error.message);
        });
    }
  }

  // Close modal when clicking outside
  document
    .getElementById("deleteUserModal")
    .addEventListener("click", function (e) {
      if (e.target === this) {
        hideDeleteUserModal();
      }
    });

  // Load dashboard stats
  function loadDashboardStats() {
    fetch("/admin/accounts/user/stats/")
      .then((response) => response.json())
      .then((data) => {
        if (data.user_stats) {
          document.getElementById("agents-count").textContent =
            data.user_stats.agents || 0;
          document.getElementById("qualifiers-count").textContent =
            data.user_stats.qualifiers || 0;
          document.getElementById("salesreps-count").textContent =
            data.user_stats.salesreps || 0;
        }
        if (data.lead_stats) {
          document.getElementById("leads-count").textContent =
            data.lead_stats.total || 0;
        }
      })
      .catch((error) => {
      });
  }

  // Load stats when page loads
  document.addEventListener("DOMContentLoaded", loadDashboardStats);

  // Filter functions
  function filterUsers(role) {
    const url = new URL(window.location.origin + '/admin/accounts/user/');
    url.searchParams.set('role__exact', role);
    window.open(url.toString(), '_blank');
  }

  function filterLeads() {
    const url = new URL(window.location.origin + '/admin/leads/lead/');
    window.open(url.toString(), '_blank');
  }
</script>
{% endblock %}
