<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agent Dashboard Simulation</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }
      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
      }
      .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #667eea;
      }
      .stat-label {
        color: #666;
        margin-top: 5px;
      }
      .leads-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .lead-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        background: #f9f9f9;
        transition: all 0.3s ease;
      }
      .lead-card.new {
        border-color: #4caf50;
        background: #e8f5e8;
        animation: slideIn 0.5s ease-out;
      }
      .lead-card.new::before {
        content: "🆕 NEW";
        background: #4caf50;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8em;
        margin-right: 10px;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .lead-name {
        font-weight: bold;
        color: #333;
      }
      .lead-phone {
        color: #666;
        margin: 5px 0;
      }
      .lead-status {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8em;
        font-weight: bold;
      }
      .status-interested {
        background: #e3f2fd;
        color: #1976d2;
      }
      .status-sent_to_kelly {
        background: #fff3e0;
        color: #f57c00;
      }
      .status-qualified {
        background: #e8f5e8;
        color: #388e3c;
      }
      .lead-time {
        font-size: 0.8em;
        color: #999;
        margin-top: 5px;
      }
      .refresh-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4caf50;
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-size: 0.9em;
      }
      .refresh-indicator.updating {
        background: #ff9800;
      }
      .no-leads {
        text-align: center;
        color: #666;
        padding: 40px;
        font-style: italic;
      }
      .agent-selector {
        margin-bottom: 20px;
      }
      .agent-selector select {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ddd;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>🎭 Agent Dashboard Simulation</h1>
        <p>
          This simulates how the agent dashboard would look with auto-refresh
          functionality
        </p>
      </div>

      <div class="agent-selector">
        <label for="agentSelect">Select Agent to Simulate:</label>
        <select id="agentSelect">
          <option value="agent1">Agent 1</option>
          <option value="agent2">Agent 2</option>
        </select>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-number" id="totalLeads">0</div>
          <div class="stat-label">Total Leads</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="newLeads">0</div>
          <div class="stat-label">New Leads Today</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="interestedLeads">0</div>
          <div class="stat-label">Interested</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="qualifiedLeads">0</div>
          <div class="stat-label">Qualified</div>
        </div>
      </div>

      <div class="leads-section">
        <h2>📋 My Leads</h2>
        <div id="leadsContainer">
          <div class="no-leads">
            No leads yet. Run the simulation to see leads appear!
          </div>
        </div>
      </div>

      <div class="refresh-indicator" id="refreshIndicator">
        🔄 Auto-refresh: ON
      </div>
    </div>

    <script>
      class AgentDashboardSimulator {
        constructor() {
          this.leads = [];
          this.lastFetchTime = null;
          this.refreshInterval = null;
          this.agentSelect = document.getElementById("agentSelect");
          this.leadsContainer = document.getElementById("leadsContainer");
          this.refreshIndicator = document.getElementById("refreshIndicator");

          this.init();
        }

        init() {
          // Start auto-refresh
          this.startAutoRefresh();

          // Listen for agent changes
          this.agentSelect.addEventListener("change", () => {
            this.fetchLeads();
          });

          // Initial fetch
          this.fetchLeads();
        }

        async fetchLeads() {
          const selectedAgent = this.agentSelect.value;
          this.refreshIndicator.textContent = "🔄 Fetching leads...";
          this.refreshIndicator.className = "refresh-indicator updating";

          try {
            // Simulate API call delay
            await new Promise((resolve) => setTimeout(resolve, 500));

            // In a real implementation, this would be:
            // const response = await fetch(`/api/leads/my/`);
            // const data = await response.json();

            // For simulation, we'll use mock data
            const mockLeads = this.getMockLeads(selectedAgent);

            // Check for new leads
            const currentLeadIds = new Set(this.leads.map((lead) => lead.id));
            const newLeads = mockLeads.filter(
              (lead) => !currentLeadIds.has(lead.id)
            );

            if (newLeads.length > 0) {
              this.showNewLeadNotification(newLeads.length);
            }

            this.leads = mockLeads;
            this.updateUI();
          } catch (error) {
            console.error("Failed to fetch leads:", error);
          } finally {
            this.refreshIndicator.textContent = "🔄 Auto-refresh: ON";
            this.refreshIndicator.className = "refresh-indicator";
          }
        }

        getMockLeads(agentUsername) {
          // This would normally come from the API
          // For simulation, we'll return mock data based on the agent
          const baseLeads = [
            {
              id: 1,
              full_name: "John Smith",
              phone: "+1234567890",
              email: "john.smith@email.com",
              status: "interested",
              notes: "Interested in solar panels",
              created_at: new Date(Date.now() - 300000).toISOString(),
              assigned_agent_username: "agent1",
            },
            {
              id: 2,
              full_name: "Sarah Johnson",
              phone: "+1234567891",
              email: "sarah.j@email.com",
              status: "sent_to_kelly",
              notes: "Looking for energy efficiency solutions",
              created_at: new Date(Date.now() - 600000).toISOString(),
              assigned_agent_username: "agent2",
            },
          ];

          // Filter leads for the selected agent
          return baseLeads.filter(
            (lead) => lead.assigned_agent_username === agentUsername
          );
        }

        showNewLeadNotification(count) {
          // Create a toast notification
          const notification = document.createElement("div");
          notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #4CAF50;
                    color: white;
                    padding: 15px 25px;
                    border-radius: 5px;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                    z-index: 1000;
                    animation: slideDown 0.3s ease-out;
                `;
          notification.textContent = `🎉 ${count} new lead(s) received!`;

          document.body.appendChild(notification);

          // Remove notification after 3 seconds
          setTimeout(() => {
            notification.remove();
          }, 3000);
        }

        updateUI() {
          this.updateStats();
          this.renderLeads();
        }

        updateStats() {
          const totalLeads = this.leads.length;
          const newLeads = this.leads.filter((lead) => {
            const leadTime = new Date(lead.created_at);
            const today = new Date();
            return leadTime.toDateString() === today.toDateString();
          }).length;
          const interestedLeads = this.leads.filter(
            (lead) => lead.status === "interested"
          ).length;
          const qualifiedLeads = this.leads.filter(
            (lead) => lead.status === "qualified"
          ).length;

          document.getElementById("totalLeads").textContent = totalLeads;
          document.getElementById("newLeads").textContent = newLeads;
          document.getElementById("interestedLeads").textContent =
            interestedLeads;
          document.getElementById("qualifiedLeads").textContent =
            qualifiedLeads;
        }

        renderLeads() {
          if (this.leads.length === 0) {
            this.leadsContainer.innerHTML =
              '<div class="no-leads">No leads yet. Run the simulation to see leads appear!</div>';
            return;
          }

          const leadsHTML = this.leads
            .map(
              (lead) => `
                    <div class="lead-card">
                        <div class="lead-name">${lead.full_name}</div>
                        <div class="lead-phone">📱 ${lead.phone}</div>
                        <div class="lead-phone">📧 ${lead.email}</div>
                        <div>
                            <span class="lead-status status-${
                              lead.status
                            }">${lead.status
                .replace("_", " ")
                .toUpperCase()}</span>
                        </div>
                        <div class="lead-time">Created: ${new Date(
                          lead.created_at
                        ).toLocaleString()}</div>
                    </div>
                `
            )
            .join("");

          this.leadsContainer.innerHTML = leadsHTML;
        }

        startAutoRefresh() {
          // Refresh every 2 seconds (same as the real implementation)
          this.refreshInterval = setInterval(() => {
            this.fetchLeads();
          }, 2000);
        }

        stopAutoRefresh() {
          if (this.refreshInterval) {
            clearInterval(this.refreshInterval);
            this.refreshIndicator.textContent = "⏸️ Auto-refresh: OFF";
          }
        }
      }

      // Add CSS for notification animation
      const style = document.createElement("style");
      style.textContent = `
            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateX(-50%) translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateX(-50%) translateY(0);
                }
            }
        `;
      document.head.appendChild(style);

      // Initialize the simulator
      const simulator = new AgentDashboardSimulator();

      // Add some instructions
      console.log("🎭 Agent Dashboard Simulator Started!");
      console.log("📋 Instructions:");
      console.log(
        "1. Run the Python simulation script: python simulate_dialer_integration.py"
      );
      console.log("2. Watch this page for new leads appearing");
      console.log("3. Switch between agents to see different lead sets");
      console.log("4. Notice the auto-refresh every 2 seconds");
    </script>
  </body>
</html>

